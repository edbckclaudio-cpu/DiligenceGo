"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[515],{1515:(e,t,o)=>{o.d(t,{I:()=>A,Km:()=>m,Tp:()=>n,VP:()=>l,cB:()=>r,iT:()=>C,mj:()=>z,vW:()=>i,vf:()=>B,ww:()=>k});var a=o(9349);class r extends Error{constructor(e="Servi\xe7o da CVM indispon\xedvel no momento",t,o){super(e),this.name="CVMOfflineError",this.status=t,this.url=o}}class l extends Error{constructor(e="Conjunto de dados indispon\xedvel no momento",t,o){super(e),this.name="CVMUnavailableError",this.status=t,this.url=o}}function n(e){return(e||"").replace(/\D+/g,"")}function i(){return new Date().getFullYear()}function c(e){let t=e.replace(/[^A-Za-z0-9+/=]/g,""),o="";try{o=atob(t)}catch(o){let e=window.base64js;if(e&&"function"==typeof e.toByteArray)return e.toByteArray(t);throw Error("Falha ao decodificar base64")}let a=new Uint8Array(o.length);for(let e=0;e<o.length;e++)a[e]=o.charCodeAt(e);return a}function s(e){try{return new TextDecoder("iso-8859-1").decode(e)}catch(a){let t=new Uint8Array(e),o="";for(let e=0;e<t.length;e++)o+=String.fromCharCode(t[e]);return o}}function f(e){let t=e.slice(0,4e3),o=e=>(t.match(RegExp("\\".concat(e),"g"))||[]).length,a=o(";"),r=[{ch:";",n:a},{ch:",",n:o(",")},{ch:"	",n:o("	")}].sort((e,t)=>t.n-e.n);return r[0].n>0?r[0].ch:";"}let u=["cnpj","cnpj cia","cnpj companhia","cnpjcia","cnpjcompanhia"];function p(e,t){let o=e.map(e=>String(e||"").toLowerCase().replace(/\s+/g," ").trim()),a=[];for(let e=0;e<o.length;e++){let t=o[e];if(t.includes("cnpj")){a.push(e);continue}for(let o of u)if(t===o){a.push(e);break}}return a}function d(){}function h(e,t){if("FRE"===e)return"https://dados.cvm.gov.br/dados/CIA_ABERTA/DOC/FRE/DADOS/fre_cia_aberta_".concat(t,".zip");throw new l("Base PAS indispon\xedvel no momento")}function m(e){return h("FRE",e)}async function g(){return d(),caches.open("diligencego-zip-cache")}async function w(){try{let e=await g(),t=await e.keys();await Promise.all(t.map(t=>e.delete(t))),console.log("cvm:cache:purged")}catch(e){console.log("cvm:cache:purge-error",String(e&&e.message||e))}}function y(){return new Date().toISOString().slice(0,10)}async function v(e,t){let a=h(e,t),l="/api/fre/".concat(t),n=!1,i=null,s="undefined"!=typeof location?location.protocol:"",f="undefined"!=typeof location?location.hostname:"";try{let e=await o.e(968).then(o.bind(o,2587)),t=e.Capacitor||e.default||null;if(t&&"function"==typeof t.isNativePlatform&&(n=!!t.isNativePlatform()),!(i=e.CapacitorHttp||null))try{i=(await Promise.all([o.e(968),o.e(380)]).then(o.bind(o,380))).Http||null}catch(e){}}catch(e){}let u="capacitor:"===s||"file:"===s,p="localhost"===f,d=n||u||p?a:l;console.log("cvm:fetchZipBlob:start",{dataset:e,year:t,directUrl:a,proxyUrl:l,chosen:d,protocol:s,host:f,isNative:n}),(n||u)&&await w();let m=new Request("".concat(d,"?day=").concat(y()),{cache:"no-store"}),v=await g(),B=await v.match(m);if(B){let e=await B.blob();return console.log("cvm:fetchZipBlob:cache-hit",{url:m.url,size:e.size}),e}try{var k,z,E;let o;if(n)try{if(!i)throw Error("CapacitorHttp indispon\xedvel");let e=await i.get({url:a,responseType:"arraybuffer",connectTimeout:2e4,readTimeout:6e4,shouldEncodeUrlParams:!1}),t=null!=(k=null==e?void 0:e.status)?k:0,o=null==e?void 0:e.data;if(console.log("cvm:fetchZipBlob:native-http",{url:a,status:t}),t>=200&&t<300&&null!=o){let e;if(o instanceof ArrayBuffer)e=o;else if("string"==typeof o)e=c(o).buffer;else if("string"==typeof(null==o?void 0:o.data))e=c(o.data).buffer;else throw Error("Resposta nativa sem ArrayBuffer/base64 esperado");let t=new Blob([e],{type:"application/zip"});return await v.put(new Request("".concat(a,"?day=").concat(y()),{cache:"no-store"}),new Response(t)),console.log("cvm:fetchZipBlob:native-ok",{url:a,size:t.size}),t}throw Error("HTTP nativo status ".concat(t))}catch(n){console.log("cvm:fetchZipBlob:native-http-error",String(n&&n.message||n));let o=2026===t?2025:void 0;if("FRE"===e&&void 0!==o)try{let t=h(e,o),a=await i.get({url:t,responseType:"arraybuffer"}),r=null!=(z=null==a?void 0:a.status)?z:0,l=null==a?void 0:a.data;if(console.log("cvm:fetchZipBlob:native-http-fallback",{url:t,status:r}),r>=200&&r<300&&null!=l){let e;if(l instanceof ArrayBuffer)e=l;else if("string"==typeof l)e=c(l).buffer;else if("string"==typeof(null==l?void 0:l.data))e=c(l.data).buffer;else throw Error("Resposta nativa sem ArrayBuffer/base64 esperado");let o=new Blob([e],{type:"application/zip"});return await v.put(new Request("".concat(t,"?day=").concat(y()),{cache:"no-store"}),new Response(o)),console.log("cvm:fetchZipBlob:native-fallback-ok",{url:t,size:o.size}),o}}catch(e){}let l=await b(v,a);if(l)return l;throw new r("Erro de rede ao baixar dados da CVM (nativo)",void 0,a)}if(n||u||p?(d=a,console.log("cvm:fetchZipBlob:fetch-direct",{url:d}),o=await fetch(a,{redirect:"follow"})):(console.log("cvm:fetchZipBlob:fetch-proxy",{url:l}),(o=await fetch(l,{redirect:"follow"})).ok||(d=a,console.log("cvm:fetchZipBlob:fallback-direct",{url:d,status:o.status}),o=await fetch(a,{redirect:"follow"}))),!o.ok){let l=2026===t?2025:void 0;if("FRE"===e&&void 0!==l){let t=h(e,l);try{if(n&&i){let e=await i.get({url:t,responseType:"arraybuffer"}),o=null!=(E=null==e?void 0:e.status)?E:0,a=null==e?void 0:e.data;if(console.log("cvm:fetchZipBlob:native-http-fallback",{url:t,status:o}),a&&o>=200&&o<300){let e;if(a instanceof ArrayBuffer)e=a;else if("string"==typeof a)e=c(String(a)).buffer;else if("string"==typeof(null==a?void 0:a.data))e=c(a.data).buffer;else throw Error("Resposta nativa sem ArrayBuffer/base64 esperado");let o=new Blob([e],{type:"application/zip"});return await v.put(new Request("".concat(t,"?day=").concat(y()),{cache:"no-store"}),new Response(o)),console.log("cvm:fetchZipBlob:native-fallback-ok",{url:t,size:o.size}),o}}}catch(e){}try{let e=await fetch(t,{redirect:"follow"});if(e.ok){let o=e.clone();await v.put(new Request("".concat(t,"?day=").concat(y()),{cache:"no-store"}),o);let a=await e.blob();return console.log("cvm:fetchZipBlob:http-fallback-ok",{url:t,size:a.size}),a}}catch(e){}}let s=await b(v,a);if(s)return s;throw console.log("cvm:fetchZipBlob:http-error",{url:d,status:o.status}),new r("Falha ao baixar FRE ".concat(t,": ").concat(o.status),o.status,d)}let s=o.clone();await v.put(m,s);let f=await o.blob();return console.log("cvm:fetchZipBlob:http-ok",{url:d,size:f.size}),f}catch(o){let e=await g(),t=await b(e,a);if(t)return t;throw console.log("cvm:fetchZipBlob:network-error",{url:a,error:String(o&&o.message||o)}),new r("Erro de rede ao baixar dados da CVM",void 0,a)}}async function b(e,t){for(let o of(await e.keys()))if(o.url.startsWith(t)){let t=await e.match(o);if(t)return t.blob()}return null}async function B(e,t){let r=n(e),l=null!=t?t:i();console.log("cvm:parse:start",{cnpj:r,year:l});let c=await v("FRE",l);console.log("cvm:parse:zip",{size:c.size});let u=await o.e(496).then(o.t.bind(o,7496,23)),d=u.default||u,h=await d.loadAsync(await c.arrayBuffer()),m=[],g=Object.keys(h.files).filter(e=>e.toLowerCase().endsWith(".csv"));for(let e of(console.log("cvm:parse:entries",{count:g.length}),g)){let t=h.file(e);if(t){console.log("Iniciando arquivo:",e);try{var w,y;let o=await t.async("arraybuffer"),l=s(o),n=f(l),i=l.split(/\r?\n/).find(e=>e.trim().length>0)||"",c=i?i.split(n).map(e=>e.trim()):[];console.log("cvm:parse:headers",{name:e,headers:c});let u=a.parse(l,{delimiter:n,skipEmptyLines:!0,header:!1,dynamicTyping:!1}),d=[],h=u.data,g=null!=(y=null==u||null==(w=u.meta)?void 0:w.delimiter)?y:"",v=p(c,n);for(let t of(console.log("cvm:parse:cnpj-columns",{name:e,indices:v}),h))if(Array.isArray(t))if(v.length>0){let e=!1;for(let o of v){let a=t[o];if("string"==typeof a&&a.replace(/\D+/g,"")===r){e=!0;break}}e&&d.push(t)}else{let e=!1;for(let o of t)if("string"==typeof o&&o.replace(/\D+/g,"")===r){e=!0;break}e&&d.push(t)}m.push({file:e,rows:d,headers:c,delimiter:n}),console.log("cvm:parse:file",{name:e,rows:d.length,delimiter:g}),u=null,l="",o=null,console.log("Finalizado:",e),await new Promise(e=>setTimeout(e,0))}catch(t){console.log("cvm:parse:file-error",{name:e,error:String(t&&t.message||t)})}}}let b={cnpj:r,year:l,files:m};try{E(b)}catch(e){}return console.log("cvm:parse:done",{files:m.length}),b}async function k(e,t,r){let l=n(e),c=null!=r?r:i();console.log("cvm:parse-blob:start",{cnpj:l,year:c,size:t.size});let u=await o.e(496).then(o.t.bind(o,7496,23)),d=u.default||u,h=await d.loadAsync(await t.arrayBuffer()),m=[],g=Object.keys(h.files).filter(e=>e.toLowerCase().endsWith(".csv"));for(let e of(console.log("cvm:parse-blob:entries",{count:g.length}),g)){let t=h.file(e);if(t){console.log("Iniciando arquivo:",e);try{var w,y;let o=await t.async("arraybuffer"),r=s(o),n=f(r),i=r.split(/\r?\n/).find(e=>e.trim().length>0)||"",c=i?i.split(n).map(e=>e.trim()):[];console.log("cvm:parse-blob:headers",{name:e,headers:c});let u=a.parse(r,{delimiter:n,skipEmptyLines:!0,header:!1,dynamicTyping:!1}),d=[],h=u.data,g=null!=(y=null==u||null==(w=u.meta)?void 0:w.delimiter)?y:"",v=p(c,n);for(let t of(console.log("cvm:parse-blob:cnpj-columns",{name:e,indices:v}),h))if(Array.isArray(t))if(v.length>0){let e=!1;for(let o of v){let a=t[o];if("string"==typeof a&&a.replace(/\D+/g,"")===l){e=!0;break}}e&&d.push(t)}else{let e=!1;for(let o of t)if("string"==typeof o&&o.replace(/\D+/g,"")===l){e=!0;break}e&&d.push(t)}m.push({file:e,rows:d,headers:c,delimiter:n}),console.log("cvm:parse-blob:file",{name:e,rows:d.length,delimiter:g}),u=null,r="",o=null,console.log("Finalizado:",e),await new Promise(e=>setTimeout(e,0))}catch(t){console.log("cvm:parse-blob:file-error",{name:e,error:String(t&&t.message||t)})}}}let v={cnpj:l,year:c,files:m};try{E(v)}catch(e){}return console.log("cvm:parse-blob:done",{files:m.length}),v}function z(e){return e instanceof l?"A base PAS est\xe1 indispon\xedvel no momento. Tente novamente mais tarde ou utilize dados em cache.":e instanceof r?"N\xe3o foi poss\xedvel acessar os dados da CVM agora. Verifique sua conex\xe3o ou carregue resultados salvos em cache.":"Ocorreu um erro inesperado. Tente novamente em instantes."}function E(e){let t="DiligenceGo:report:".concat(e.cnpj,":").concat(e.year),o=JSON.stringify(e);window.localStorage.setItem(t,o)}function A(e,t){let o="DiligenceGo:report:".concat(n(e),":").concat(t),a=window.localStorage.getItem(o);if(!a)return null;try{return JSON.parse(a)}catch(e){return null}}async function C(){try{await w()}catch(e){}try{for(let e of Object.keys(window.localStorage))e.startsWith("DiligenceGo:report:")&&window.localStorage.removeItem(e)}catch(e){}}}}]);